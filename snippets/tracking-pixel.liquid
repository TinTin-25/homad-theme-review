{% if settings.meta_pixel_id != blank %}
{% endif %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    {% if request.page_type == 'thank_you' %}
      var currency = {{ checkout.currency | json }};
      var value = {{ checkout.total_price | money_without_currency | json }};
      var content_ids = [
        {% for line in checkout.line_items %}
          {{ line.variant_id }}{% unless forloop.last %},{% endunless %}
        {% endfor %}
      ];
      var contents = [
        {% for line in checkout.line_items %}
          {id: {{ line.variant_id }}, quantity: {{ line.quantity }}}{% unless forloop.last %},{% endunless %}
        {% endfor %}
      ];
      var payload = {content_ids: content_ids, contents: contents, value: value, currency: currency};
      {% if settings.meta_pixel_id != blank %}
      fbq('track', 'Purchase', payload);
      {% endif %}
      {% if settings.tiktok_pixel_id != blank %}
      ttq.track('Purchase', payload);
      {% endif %}
    {% endif %}
  });
</script>
